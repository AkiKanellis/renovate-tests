---
services:
  github-runner-homelab:
    # We need the latest image until the next release because it includes
    # creating an access token from a GitHub application.
    # See: https://github.com/myoung34/docker-github-actions-runner/pull/254
    image: myoung34/github-runner:latest@sha256:e190e9f1b710d96187ed2d4e06983c2bf96c5a4615b85924a1c3538617f87ece # editorconfig-checker-disable-line

    # This is the `runner` user.
    # See: https://github.com/myoung34/docker-github-actions-runner/wiki/Usage#non-root-runners editorconfig-checker-disable-line
    user: "1001:121"

    environment:
      # Runner
      RUNNER_NAME_PREFIX: homelab
      REPO_URL: https://github.com/akikanellis/homelab
      RUNNER_SCOPE: repo
      LABELS: linux,x64,prod

      # GitHub app
      APP_ID: "{{ aki_bot_app_id }}"
      APP_PRIVATE_KEY: |-
        {{ aki_bot_app_private_key | indent(width=8) }}

      # Other
      RUN_AS_ROOT: "false"
      DISABLE_AUTO_UPDATE: "true"
      RUNNER_WORKDIR: /data/work
    volumes:
      - "{{ volumes_directory }}/github-runner-homelab/data:/data"

      - /var/run/docker.sock:/var/run/docker.sock
    restart: always
